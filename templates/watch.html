<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Movie - NetMirror</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-film me-2"></i>NetMirror
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Watch</a>
                    </li>
                </ul>
                <div class="navbar-nav">
                    <button class="btn btn-outline-light btn-sm" onclick="window.history.back()">
                        <i class="fas fa-arrow-left me-1"></i>Back
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Video Player Section -->
    <section class="player-section">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="video-container">
                        <!-- Loading Indicator -->
                        <div id="player-loading" class="player-loading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading stream...</span>
                            </div>
                            <p class="mt-3">Finding the best stream for you...</p>
                        </div>

                        <!-- Error Message -->
                        <div id="player-error" class="player-error d-none">
                            <div class="error-content">
                                <i class="fas fa-exclamation-triangle"></i>
                                <h3>Stream Not Available</h3>
                                <p id="error-message">Unable to load the video stream. Please try again later.</p>
                                <button class="btn btn-primary" onclick="retryStream()">
                                    <i class="fas fa-redo me-2"></i>Retry
                                </button>
                                <button class="btn btn-secondary ms-2" onclick="tryDifferentSource()">
                                    <i class="fas fa-exchange-alt me-2"></i>Try Different Source
                                </button>
                            </div>
                        </div>

                        <!-- Video Player -->
                        <video id="video-player" class="video-player d-none" controls preload="none" playsinline>
                            <source id="video-source" src="" type="application/x-mpegURL">
                            Your browser does not support the video tag.
                        </video>

                        <!-- Iframe Player (fallback) -->
                        <iframe id="iframe-player" class="iframe-player d-none" allowfullscreen allow="autoplay; encrypted-media"></iframe>

                        <!-- Player Controls -->
                        <div id="player-controls" class="player-controls d-none">
                            <div class="controls-bar">
                                <button id="play-pause-btn" class="control-btn">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button id="volume-btn" class="control-btn">
                                    <i class="fas fa-volume-up"></i>
                                </button>
                                <input id="volume-slider" type="range" min="0" max="1" step="0.1" value="1" class="volume-slider">
                                <div class="time-display">
                                    <span id="current-time">00:00</span> / <span id="duration">00:00</span>
                                </div>
                                <div class="quality-selector">
                                    <select id="quality-select" class="form-select form-select-sm">
                                        <option value="auto">Auto</option>
                                        <option value="1080p">1080p HD</option>
                                        <option value="720p">720p HD</option>
                                        <option value="480p">480p</option>
                                        <option value="360p">360p</option>
                                    </select>
                                </div>
                                <button id="fullscreen-btn" class="control-btn">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Movie Info Section -->
    <section class="movie-info-section">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="movie-details">
                        <h1 id="movie-title">Loading...</h1>
                        <div class="movie-meta">
                            <span id="movie-year" class="badge bg-secondary">-</span>
                            <span id="movie-rating" class="badge bg-warning">-</span>
                            <span id="movie-runtime" class="badge bg-info">-</span>
                        </div>
                        <p id="movie-plot" class="movie-plot">Loading movie information...</p>
                        <div class="movie-details-grid">
                            <div class="detail-item">
                                <strong>Director:</strong> <span id="movie-director">-</span>
                            </div>
                            <div class="detail-item">
                                <strong>Genre:</strong> <span id="movie-genre">-</span>
                            </div>
                            <div class="detail-item">
                                <strong>Cast:</strong> <span id="movie-actors">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="movie-poster">
                        <img id="movie-poster-img" src="" alt="Movie Poster" class="img-fluid">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Source Selection -->
    <section class="source-selection">
        <div class="container">
            <h3>Select Streaming Source</h3>
            <div class="source-buttons">
                <button class="btn btn-outline-primary source-btn active" onclick="loadStream('auto')">
                    <i class="fas fa-magic me-2"></i>Auto (Best)
                </button>
                <button class="btn btn-outline-primary source-btn" onclick="loadStream('vidsrc')">
                    <i class="fas fa-video me-2"></i>VidSrc
                </button>
                <button class="btn btn-outline-primary source-btn" onclick="loadStream('mixdrop')">
                    <i class="fas fa-play-circle me-2"></i>MixDrop
                </button>
                <button class="btn btn-outline-primary source-btn" onclick="loadStream('streamwish')">
                    <i class="fas fa-stream me-2"></i>StreamWish
                </button>
                <button class="btn btn-outline-primary source-btn" onclick="loadStream('doodstream')">
                    <i class="fas fa-cloud me-2"></i>DoodStream
                </button>
            </div>
        </div>
    </section>

    <!-- Debug Info (for development) -->
    <section class="debug-info d-none">
        <div class="container">
            <h4>Debug Information</h4>
            <div class="debug-panel">
                <div class="debug-item">
                    <strong>IMDb ID:</strong> <span id="debug-imdb">{{ imdb_id }}</span>
                </div>
                <div class="debug-item">
                    <strong>Current Source:</strong> <span id="debug-source">-</span>
                </div>
                <div class="debug-item">
                    <strong>Stream URL:</strong> <span id="debug-url">-</span>
                </div>
                <div class="debug-item">
                    <strong>Player Type:</strong> <span id="debug-player">-</span>
                </div>
            </div>
        </div>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/player.js"></script>
    <script>
        // Initialize player with IMDb ID
        const imdbId = "{{ imdb_id }}";
        let netMirrorPlayer = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            netMirrorPlayer = new NetMirrorPlayer(imdbId);
        });
        
        // Global functions for source buttons
        function loadStream(source) {
            if (netMirrorPlayer) {
                netMirrorPlayer.loadStream(source);
            }
        }
        
        function retryStream() {
            if (netMirrorPlayer) {
                netMirrorPlayer.loadStream(netMirrorPlayer.currentSource || 'auto');
            }
        }
        
        function tryDifferentSource() {
            if (netMirrorPlayer) {
                const nextSource = netMirrorPlayer.getNextSource();
                netMirrorPlayer.loadStream(nextSource);
            }
        }
    </script>
</body>
</html>
